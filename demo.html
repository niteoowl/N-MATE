<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLOW - ì˜¤ëŠ˜ì„ ê°ê°ì ìœ¼ë¡œ ì •ë¦¬í•˜ë‹¤</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons CDN -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/phosphor.js"></script>
    <style>
        @font-face {
            font-family: 'IM_Hyemin-Bold';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2106@1.1/IM_Hyemin-Bold.woff2') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* Changed to white background */
            color: #333;
            display: flex;
            flex-direction: column; /* Allow content and nav to stack */
            justify-content: flex-start; /* Align content to the top */
            align-items: center; /* Center the main content horizontally */
            min-height: 100vh;
            padding-bottom: 3.5rem; /* Adjusted padding for the fixed navigation bar height */
            box-sizing: border-box;
        }

        /* Main content area */
        main {
            max-width: 600px; /* Limit content width */
            width: 100%;
            border-radius: 2rem; /* Keep rounded corners for overall soft feel */
            padding: 2.5rem; /* Internal padding for content within the main area */
            box-sizing: border-box;
        }

        /* Custom checkbox style */
        .task-checkbox {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid #ccc;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            position: relative;
            flex-shrink: 0; /* Prevent checkbox from shrinking */
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }

        .task-checkbox:checked {
            background-color: #888; /* Darker gray when checked */
            border-color: #888;
        }

        .task-checkbox:checked::after {
            content: 'âœ“';
            color: white;
            font-size: 16px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Animation for task completion */
        @keyframes fadeOutShrink {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
                height: auto;
                margin-bottom: 1rem;
            }
            70% {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
                height: auto;
                margin-bottom: 1rem;
            }
            100% {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
                height: 0;
                margin-bottom: 0;
                padding-top: 0;
                padding-bottom: 0;
                overflow: hidden;
            }
        }

        .task-card.completed {
            animation: fadeOutShrink 0.6s forwards;
        }

        /* Mood emoji selection */
        .mood-emoji {
            cursor: pointer;
            transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
            filter: grayscale(100%); /* Desaturate by default */
        }

        .mood-emoji.selected {
            transform: scale(1.2);
            filter: grayscale(0%); /* Full color when selected */
        }

        /* Mood tracker specific styles */
        #mood-tracker {
            background-color: transparent; /* Make background transparent */
            box-shadow: none; /* Remove shadow */
            padding: 1rem 0; /* Adjust padding as needed for spacing */
        }

        /* Navigation item hover/active effects */
        .nav-item {
            transition: transform 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .nav-item:hover {
            transform: translateY(-2px);
            color: #555;
        }
        .nav-item.active {
            color: #000; /* Active item color */
            font-weight: bold;
        }

        /* Daily note editable div specific styles for single line effect */
        #daily-note-editable {
            font-family: 'IM_Hyemin-Bold', sans-serif; /* Apply the custom font */
            border: none; /* Remove all borders */
            border-bottom: 1px solid #E0D0D0; /* Only a bottom border for the line */
            padding: 5px 0; /* Minimal padding to align text with the line */
            line-height: 1.5em; /* Adjust to ensure text sits on the line */
            min-height: 1.5em; /* Ensure it's at least one line high */
            outline: none !important; /* Remove focus outline */
            box-shadow: none !important; /* Remove any focus shadow/ring */
            color: #333; /* Text color */
            font-size: 1.125rem; /* Corresponds to text-lg in Tailwind */
            white-space: normal; /* Allow text to wrap if it exceeds one line */
            word-break: break-word; /* Ensure long words break */
            overflow-wrap: break-word; /* Ensure long words break */
            resize: vertical; /* Allow vertical resizing */
            background-color: transparent; /* Ensure no background color */
        }

        /* Button group for daily note */
        .note-buttons-container {
            display: flex;
            align-items: center;
            gap: 1rem; /* Space between the text area and the button group */
        }

        .large-button-wrapper {
            background-color: #F5F5F5; /* Very light gray background for the large button */
            border-radius: 9999px; /* Fully rounded */
            padding: 0.25rem; /* Small padding inside the large button */
            display: flex;
            gap: 0.25rem; /* Space between small buttons */
            /* Removed box-shadow */
        }

        .small-button {
            padding: 0.3rem 0.7rem; /* Adjusted padding to make buttons smaller */
            border-radius: 9999px; /* Fully rounded */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #333; /* Darker text (almost black) */
            background-color: transparent;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap; /* Prevent text wrapping */
            /* Removed box-shadow */
        }

        .small-button.active-note-type {
            background-color: #ffffff; /* White background when active */
            color: #333; /* Darker text when active */
            /* Removed box-shadow */
        }
    </style>
</head>
<body>
    <main>
        <!-- ìƒë‹¨ ë‚ ì§œ + ì¸ì‚¬ -->
        <header class="mb-8">
            <p id="current-date" class="text-lg text-gray-500 mb-2"></p>
            <h1 id="greeting-message" class="text-4xl font-bold text-gray-800"></h1>
            <!-- ë‚ ì”¨ ì •ë³´ -->
            <div id="weather-info" class="text-lg text-gray-600 mt-2 flex items-center">
                <span id="weather-icon" class="mr-2 text-2xl"></span>
                <span id="weather-text">ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>
            </div>
        </header>

        <!-- ì˜¤ëŠ˜ì˜ í•  ì¼ ë¦¬ìŠ¤íŠ¸ -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-5">ì˜¤ëŠ˜ì˜ í•  ì¼</h2>
            <div id="task-list" class="space-y-4">
                <!-- Task Card 1 -->
                <div class="task-card flex items-center p-5 rounded-xl border border-gray-300 bg-transparent transition-all duration-300 ease-in-out">
                    <input type="checkbox" class="task-checkbox mr-4" id="task1">
                    <label for="task1" class="text-lg text-gray-800 flex-grow cursor-pointer">í”„ë¡œì íŠ¸ ê¸°íšì„œ ì´ˆì•ˆ ì‘ì„±</label>
                </div>
                <!-- Task Card 2 -->
                <div class="task-card flex items-center p-5 rounded-xl border border-gray-300 bg-transparent transition-all duration-300 ease-in-out">
                    <input type="checkbox" class="task-checkbox mr-4" id="task2">
                    <label for="task2" class="text-lg text-gray-800 flex-grow cursor-pointer">íŒ€ ë¯¸íŒ… ì¤€ë¹„</label>
                </div>
                <!-- Task Card 3 -->
                <div class="task-card flex items-center p-5 rounded-xl border border-gray-300 bg-transparent transition-all duration-300 ease-in-out">
                    <input type="checkbox" class="task-checkbox mr-4" id="task3">
                    <label for="task3" class="text-lg text-gray-800 flex-grow cursor-pointer">ìš´ë™ 30ë¶„</label>
                </div>
                <!-- Task Card 4 -->
                <div class="task-card flex items-center p-5 rounded-xl border border-gray-300 bg-transparent transition-all duration-300 ease-in-out">
                    <input type="checkbox" class="task-checkbox mr-4" id="task4">
                    <label for="task4" class="text-lg text-gray-800 flex-grow cursor-pointer">ì ì‹¬ ì‹ì‚¬ ì˜ˆì•½</label>
                </div>
            </div>
        </section>

        <!-- í˜„ì¬ ìƒíƒœ ê°ì • ê¸°ë¡ -->
        <section class="mb-10"> <!-- Added mb-10 for spacing before the new section -->
            <h2 class="text-2xl font-semibold text-gray-700 mb-5">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€?</h2>
            <div id="mood-tracker" class="flex justify-around items-center text-4xl rounded-xl">
                <span class="mood-emoji" data-mood="happy" role="img" aria-label="happy">ğŸ˜Š</span>
                <span class="mood-emoji" data-mood="neutral" role="img" aria-label="neutral">ğŸ˜</span>
                <span class="mood-emoji" data-mood="sad" role="img" aria-label="sad">ğŸ˜”</span>
                <span class="mood-emoji" data-mood="energetic" role="img" aria-label="energetic">âš¡</span>
                <span class="mood-emoji" data-mood="calm" role="img" aria-label="calm">ğŸ˜Œ</span>
            </div>
        </section>

        <!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
        <section>
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-2xl font-semibold text-gray-700">ì˜¤ëŠ˜ì˜ í•œë§ˆë””</h2>
                <!-- New button group -->
                <div class="large-button-wrapper">
                    <button id="noteTypeToday" class="small-button active-note-type">ì˜¤ëŠ˜ì˜ í•œë§ˆë””</button>
                    <button id="noteTypeDaily" class="small-button">ì¼ê¸°</button>
                </div>
            </div>
            <div id="daily-note-editable" contenteditable="true" class="w-full rounded-xl text-lg text-gray-800"></div>
        </section>
    </main>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 max-w-[600px] w-full bg-white border-t border-gray-200 py-2 flex justify-around items-center z-10">
        <a href="#" class="nav-item flex flex-col items-center text-gray-600 hover:text-gray-900 text-sm sm:text-base p-1 rounded-md">
            <i class="ph ph-house text-2xl sm:text-3xl mb-1"></i>
            <span>í™ˆ</span>
        </a>
        <a href="#" class="nav-item flex flex-col items-center text-gray-600 hover:text-gray-900 text-sm sm:text-base p-1 rounded-md active">
            <i class="ph ph-clipboard-text text-2xl sm:text-3xl mb-1"></i>
            <span>í•  ì¼</span>
        </a>
        <a href="#" class="nav-item flex flex-col items-center text-gray-600 hover:text-gray-900 text-sm sm:text-base p-1 rounded-md">
            <i class="ph ph-lightbulb text-2xl sm:text-3xl mb-1"></i>
            <span>ì•„ì´ë””ì–´</span>
        </a>
        <a href="#" class="nav-item flex flex-col items-center text-gray-600 hover:text-gray-900 text-sm sm:text-base p-1 rounded-md">
            <i class="ph ph-gear text-2xl sm:text-3xl mb-1"></i>
            <span>ì„¤ì •</span>
        </a>
    </nav>

    <script>
        // KMA Coordinate Conversion Constants
        const RE = 6371.00877; // ì§€êµ¬ ë°˜ê²½(km)
        const GRID = 5.0;     // ê²©ì ê°„ê²©(km)
        const SLAT1 = 30.0;   // í‘œì¤€ ìœ„ë„1
        const SLAT2 = 38.0;   // í‘œì¤€ ìœ„ë„2
        const OLON = 126.0;   // ê¸°ì¤€ì  ê²½ë„
        const OLAT = 38.0;    // ê¸°ì¤€ì  ìœ„ë„
        const XO = 43;        // ê¸°ì¤€ì  Xì¢Œí‘œ
        const YO = 136;       // ê¸°ì¤€ì  Yì¢Œí‘œ

        // Function to convert Latitude/Longitude to KMA Grid Coordinates (NX, NY)
        function convertGridXY(lat, lon) {
            const DEGRAD = Math.PI / 180.0;
            const RADDEG = 180.0 / Math.PI;

            const re = RE / GRID;
            const slat1 = SLAT1 * DEGRAD;
            const slat2 = SLAT2 * DEGRAD;
            const olon = OLON * DEGRAD;
            const olat = OLAT * DEGRAD;

            let sn = Math.tan(Math.PI * 0.25 + slat2 * 0.5) / Math.tan(Math.PI * 0.25 + slat1 * 0.5);
            sn = Math.log(sn) / Math.log(Math.cos(slat1) / Math.cos(slat2));
            let sf = Math.tan(Math.PI * 0.25 + slat1 * 0.5);
            sf = Math.pow(sf, sn) * Math.cos(slat1) / sn;
            let ro = Math.tan(Math.PI * 0.25 + olat * 0.5);
            ro = re * sf / Math.pow(ro, sn);

            let ra = Math.tan(Math.PI * 0.25 + lat * DEGRAD * 0.5);
            ra = re * sf / Math.pow(ra, sn);
            let theta = lon * DEGRAD - olon;
            if (theta > Math.PI) theta -= 2.0 * Math.PI;
            if (theta < -Math.PI) theta += 2.0 * Math.PI;
            theta *= sn;

            const x = Math.floor(ra * Math.sin(theta) + XO + 0.5);
            const y = Math.floor(ro - ra * Math.cos(theta) + YO + 0.5);

            return { x, y };
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Set current date
            const dateElement = document.getElementById('current-date');
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dateElement.textContent = today.toLocaleDateString('ko-KR', options);

            // Dynamic Greeting and Weather
            const greetingMessageElement = document.getElementById('greeting-message');
            const weatherIconElement = document.getElementById('weather-icon');
            const weatherTextElement = document.getElementById('weather-text');

            function updateGreeting() {
                const currentHour = new Date().getHours();
                let greeting = "Good Evening, Jane";
                let greetingEmoji = "ğŸŒ™"; // Moon for evening

                if (currentHour >= 5 && currentHour < 12) {
                    greeting = "Good Morning, Jane";
                    greetingEmoji = "â˜€ï¸"; // Sun for morning
                } else if (currentHour >= 12 && currentHour < 18) {
                    greeting = "Good Afternoon, Jane";
                    greetingEmoji = "ğŸ‘‹"; // Waving hand for afternoon
                }

                greetingMessageElement.innerHTML = `${greeting} <span role="img" aria-label="greeting-emoji">${greetingEmoji}</span>`;
            }

            async function fetchKmaWeather(nx, ny) {
                // KMA API Service Key (Replace with your actual key from data.go.kr)
                // ì œê³µí•´ì£¼ì‹  ë””ì½”ë”©ëœ ì¸ì¦í‚¤ë¥¼ ì‚¬ìš©í•˜ë©°, URLì— í¬í•¨í•˜ê¸° ìœ„í•´ encodeURIComponentë¡œ ì¸ì½”ë”©í•©ë‹ˆë‹¤.
                const serviceKey = encodeURIComponent('E3Eos3zdsfvVFG4mC5qYCljIz3vEjbgfHA0Xnyl4zU7eXYLNaN5Tf9/qBILOxzpU+MztJyUivBxXfKAnK3lg6w==');

                // Get current date and time for base_date and base_time
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const base_date = `${year}${month}${day}`;

                // base_time: KMA API requires the latest full hour observation.
                // For getUltraSrtNcst, it's typically the current hour minus one, or the latest available.
                // APIëŠ” ì •ì‹œ ë‹¨ìœ„ë¡œ ë°œí‘œë˜ë¯€ë¡œ, í˜„ì¬ ì‹œê°ì´ 00ë¶„~40ë¶„ ì‚¬ì´ë©´ ì´ì „ ì‹œê°ì„, 41ë¶„ ì´í›„ë©´ í˜„ì¬ ì‹œê°ì„ ì‚¬ìš©
                // (ì´ˆë‹¨ê¸°ì‹¤í™©ì€ ë§¤ 40ë¶„ë§ˆë‹¤ ê°±ì‹ ë˜ë¯€ë¡œ, í˜„ì¬ ì‹œê°ì´ 40ë¶„ ì´ì „ì´ë©´ ì´ì „ ì‹œê°„ì˜ ë°ì´í„°ê°€ ìµœì‹ ì¼ ìˆ˜ ìˆìŒ)
                let base_time_hour = now.getHours();
                if (now.getMinutes() <= 40) {
                    base_time_hour = (base_time_hour - 1 + 24) % 24; // ì´ì „ ì‹œê°„, 0ì‹œì¼ ê²½ìš° 23ì‹œë¡œ
                }
                const base_time = String(base_time_hour).padStart(2, '0') + '00';

                const apiUrl = `http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst?serviceKey=${serviceKey}&pageNo=1&numOfRows=10&dataType=JSON&base_date=${base_date}&base_time=${base_time}&nx=${nx}&ny=${ny}`;

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        // HTTP ì˜¤ë¥˜ ë°œìƒ ì‹œ ìƒì„¸ ë©”ì‹œì§€ ì¶œë ¥
                        const errorText = await response.text();
                        throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                    }
                    const data = await response.json();

                    if (data.response.header.resultCode !== '00') {
                        // API ì‘ë‹µ ê²°ê³¼ ì½”ë“œ ì˜¤ë¥˜ ì‹œ ìƒì„¸ ë©”ì‹œì§€ ì¶œë ¥
                        throw new Error(`API Error: ${data.response.header.resultMsg}`);
                    }

                    const items = data.response.body.items.item;
                    let temperature = 'N/A';
                    let precipitationAmount = 'N/A';
                    let skyCondition = 'N/A';
                    let precipitationType = 'N/A';
                    let locationName = ''; // KMA API does not directly return location name for coords

                    items.forEach(item => {
                        switch (item.category) {
                            case 'T1H': // ê¸°ì˜¨
                                temperature = `${item.obsrValue}Â°C`;
                                break;
                            case 'RN1': // 1ì‹œê°„ ê°•ìˆ˜ëŸ‰
                                precipitationAmount = `${item.obsrValue}mm`;
                                break;
                            case 'SKY': // í•˜ëŠ˜ ìƒíƒœ (1:ë§‘ìŒ, 3:êµ¬ë¦„ë§ìŒ, 4:íë¦¼)
                                if (item.obsrValue === '1') skyCondition = 'ë§‘ìŒ';
                                else if (item.obsrValue === '3') skyCondition = 'êµ¬ë¦„ë§ìŒ';
                                else if (item.obsrValue === '4') skyCondition = 'íë¦¼';
                                break;
                            case 'PTY': // ê°•ìˆ˜ í˜•íƒœ (0:ì—†ìŒ, 1:ë¹„, 2:ë¹„/ëˆˆ, 3:ëˆˆ, 4:ì†Œë‚˜ê¸°, 5:ë¹—ë°©ìš¸, 6:ë¹—ë°©ìš¸ëˆˆë‚ ë¦¼, 7:ëˆˆë‚ ë¦¼)
                                if (item.obsrValue === '1') precipitationType = 'ë¹„';
                                else if (item.obsrValue === '2') precipitationType = 'ë¹„/ëˆˆ';
                                else if (item.obsrValue === '3') precipitationType = 'ëˆˆ';
                                else if (item.obsrValue === '4') precipitationType = 'ì†Œë‚˜ê¸°';
                                else if (item.obsrValue === '5') precipitationType = 'ë¹—ë°©ìš¸';
                                else if (item.obsrValue === '6') precipitationType = 'ë¹—ë°©ìš¸ëˆˆë‚ ë¦¼';
                                else if (item.obsrValue === '7') precipitationType = 'ëˆˆë‚ ë¦¼';
                                break;
                        }
                    });

                    let weatherDisplay = '';
                    let weatherEmoji = '';

                    // PTY (ê°•ìˆ˜ í˜•íƒœ) ìš°ì„ 
                    if (precipitationType !== 'N/A' && precipitationType !== '0') { // '0'ì€ "ì—†ìŒ"ì„ ì˜ë¯¸
                        weatherDisplay = `${precipitationType}, ${temperature}`;
                        if (precipitationType === 'ë¹„' || precipitationType === 'ì†Œë‚˜ê¸°' || precipitationType === 'ë¹—ë°©ìš¸') weatherEmoji = 'ğŸŒ§ï¸';
                        else if (precipitationType === 'ëˆˆ' || precipitationType === 'ëˆˆë‚ ë¦¼') weatherEmoji = 'â„ï¸';
                        else if (precipitationType === 'ë¹„/ëˆˆ' || precipitationType === 'ë¹—ë°©ìš¸ëˆˆë‚ ë¦¼') weatherEmoji = 'ğŸŒ¨ï¸';
                    } else {
                        // PTY ì—†ìœ¼ë©´ SKY (í•˜ëŠ˜ ìƒíƒœ)
                        weatherDisplay = `${skyCondition}, ${temperature}`;
                        if (skyCondition === 'ë§‘ìŒ') weatherEmoji = 'â˜€ï¸';
                        else if (skyCondition === 'êµ¬ë¦„ë§ìŒ') weatherEmoji = 'â˜ï¸';
                        else if (skyCondition === 'íë¦¼') weatherEmoji = 'â˜ï¸'; // íë¦¼ë„ êµ¬ë¦„ ì´ëª¨ì§€ë¡œ
                    }

                    // ìœ„ì¹˜ ì´ë¦„ì€ Geocoding APIë¥¼ ì‚¬ìš©í•´ì•¼ ì •í™•íˆ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    // KMA APIëŠ” ê²©ì ì¢Œí‘œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë¯€ë¡œ, ì§ì ‘ì ì¸ ì£¼ì†Œ ë°˜í™˜ì€ ì—†ìŠµë‹ˆë‹¤.
                    // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ "í˜„ì¬ ìœ„ì¹˜" ë˜ëŠ” "ì„œìš¸"ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
                    locationName = 'í˜„ì¬ ìœ„ì¹˜'; // ë˜ëŠ” ì‚¬ìš©ìì˜ ì‹¤ì œ ìœ„ì¹˜ëª… (ë³„ë„ì˜ Geocoding API í•„ìš”)

                    weatherIconElement.textContent = weatherEmoji;
                    weatherTextElement.textContent = `${locationName}: ${weatherDisplay}`;

                } catch (error) {
                    console.error("ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    weatherIconElement.textContent = 'âš ï¸';
                    weatherTextElement.textContent = `ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${error.message || error}). CORS ë˜ëŠ” Mixed Content ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
                }
            }

            function getUserLocationAndWeather() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            const { x, y } = convertGridXY(latitude, longitude);
                            fetchKmaWeather(x, y);
                        },
                        (error) => {
                            // Geolocation ì˜¤ë¥˜ ì½”ë“œì— ë”°ë¼ ë©”ì‹œì§€ ë¶„ê¸°
                            let errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ';
                            switch (error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage += 'ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage += 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                                    break;
                                case error.TIMEOUT:
                                    errorMessage += 'ìœ„ì¹˜ ì •ë³´ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                                    break;
                                default:
                                    errorMessage += error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                                    break;
                            }
                            console.error(errorMessage, error);

                            weatherIconElement.textContent = 'ğŸš«';
                            weatherTextElement.textContent = 'ìœ„ì¹˜ ê¶Œí•œì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì„œìš¸ ë‚ ì”¨ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.';
                            // ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì„œìš¸ ë‚ ì”¨ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œ (ì„œìš¸ì˜ KMA ê²©ì ì¢Œí‘œ)
                            const seoulCoords = convertGridXY(37.5665, 126.9780); // ì„œìš¸ ì‹œì²­ ìœ„ë„, ê²½ë„
                            fetchKmaWeather(seoulCoords.x, seoulCoords.y);
                        },
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 } // íƒ€ì„ì•„ì›ƒ 10ì´ˆ, ìºì‹œ 1ë¶„
                    );
                } else {
                    weatherIconElement.textContent = 'âŒ';
                    weatherTextElement.textContent = 'ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì„œìš¸ ë‚ ì”¨ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.';
                    // Geolocationì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©´ ì„œìš¸ ë‚ ì”¨ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œ (ì„œìš¸ì˜ KMA ê²©ì ì¢Œí‘œ)
                    const seoulCoords = convertGridXY(37.5665, 126.9780); // ì„œìš¸ ì‹œì²­ ìœ„ë„, ê²½ë„
                    fetchKmaWeather(seoulCoords.x, seoulCoords.y);
                }
            }

            // Initial calls
            updateGreeting();
            getUserLocationAndWeather();
            // Update greeting every hour (optional)
            // setInterval(updateGreeting, 3600000); // 1ì‹œê°„ë§ˆë‹¤ ì¸ì‚¬ë§ ì—…ë°ì´íŠ¸

            // Task completion animation
            const taskCheckboxes = document.querySelectorAll('.task-checkbox');
            taskCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', (event) => {
                    const taskCard = event.target.closest('.task-card');
                    if (event.target.checked) {
                        taskCard.classList.add('completed');
                        // Remove the card after the animation completes
                        taskCard.addEventListener('animationend', () => {
                            taskCard.remove();
                        }, { once: true });
                    }
                });
            });

            // Mood tracker selection
            const moodEmojis = document.querySelectorAll('.mood-emoji');
            moodEmojis.forEach(emoji => {
                emoji.addEventListener('click', (event) => {
                    // Remove 'selected' class from all emojis
                    moodEmojis.forEach(e => e.classList.remove('selected'));
                    // Add 'selected' class to the clicked emoji
                    event.target.classList.add('selected');
                    // You can add further logic here to save the mood
                    console.log('Selected mood:', event.target.dataset.mood);
                });
            });

            // Navigation active state (simple example)
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', (event) => {
                    navItems.forEach(e => e.classList.remove('active'));
                    event.currentTarget.classList.add('active');
                });
            });

            // Daily Note Type Selection
            const noteTypeTodayButton = document.getElementById('noteTypeToday');
            const noteTypeDailyButton = document.getElementById('noteTypeDaily');

            noteTypeTodayButton.addEventListener('click', () => {
                noteTypeTodayButton.classList.add('active-note-type');
                noteTypeDailyButton.classList.remove('active-note-type');
                // Logic for "ì˜¤ëŠ˜ì˜ í•œë§ˆë””" view
                console.log('Selected: ì˜¤ëŠ˜ì˜ í•œë§ˆë””');
            });

            noteTypeDailyButton.addEventListener('click', () => {
                noteTypeDailyButton.classList.add('active-note-type');
                noteTypeTodayButton.classList.remove('active-note-type');
                // Logic for "ì¼" view
                console.log('Selected: ì¼ê¸°');
            });
        });
    </script>
</body>
</html>
