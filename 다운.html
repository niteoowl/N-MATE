<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 다운로더</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 800px;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="container bg-white p-8 rounded-xl shadow-lg w-full">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">
            일괄 이미지 다운로더
        </h1>
        <p class="text-center text-gray-600 mb-6">
            이미지 링크를 아래에 붙여넣고 다운로드 버튼을 누르세요.<br/>
            (나무아카데미의 경우 파일명만 입력해도 자동 변환됩니다.)
        </p>

        <div class="mb-4">
            <textarea
                id="urlInput"
                class="w-full h-40 p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"
                placeholder="여기에 이미지 URL을 입력하세요..."
            ></textarea>
        </div>

        <div id="statusMessage" class="text-center text-sm text-gray-600 mb-4 hidden"></div>
        <div id="progressBarContainer" class="w-full bg-gray-200 rounded-full h-2.5 mb-4 hidden">
            <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
        </div>

        <button
            id="downloadBtn"
            class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-blue-400"
        >
            이미지 다운로드
        </button>

    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const downloadBtn = document.getElementById('downloadBtn');
        const statusMessage = document.getElementById('statusMessage');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');

        // 메시지를 표시하는 함수
        function showStatus(message, color = 'text-gray-600') {
            statusMessage.textContent = message;
            statusMessage.className = `text-center text-sm mb-4 ${color}`;
            statusMessage.classList.remove('hidden');
        }

        // 진행바를 업데이트하는 함수
        function updateProgress(progress) {
            progressBarContainer.classList.remove('hidden');
            progressBar.style.width = `${progress}%`;
        }

        // 다운로드 버튼 클릭 이벤트
        downloadBtn.addEventListener('click', async () => {
            const urls = urlInput.value.split('\n').map(url => url.trim()).filter(url => url.length > 0);

            if (urls.length === 0) {
                showStatus('다운로드할 이미지 URL을 입력해주세요.', 'text-red-500');
                return;
            }

            downloadBtn.disabled = true;
            showStatus('이미지 다운로드를 시작합니다...');
            updateProgress(0);

            let downloadedCount = 0;

            for (let i = 0; i < urls.length; i++) {
                let url = urls[i];

                // Check if the URL is a full URL or just a filename
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    // This is a hardcoded solution for a specific website's URL structure.
                    // This will not work for other websites.
                    url = 'https://www.namuacademy.com/bbs/view_image.php?fn=%2Fdata%2Feditor%2F2508%2F' + url;
                }

                try {
                    const response = await fetch(url, { mode: 'cors' });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const blob = await response.blob();
                    const fileName = url.substring(url.lastIndexOf('/') + 1) || `image_${i + 1}.png`;

                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    downloadedCount++;
                    const progress = (downloadedCount / urls.length) * 100;
                    updateProgress(progress);
                    showStatus(`${downloadedCount} / ${urls.length}개의 이미지 다운로드 중...`);

                } catch (error) {
                    console.error('다운로드 실패:', url, error);
                    // Continue even if an error occurs
                }
            }
            
            showStatus('모든 이미지 다운로드 시도가 완료되었습니다!');
            downloadBtn.disabled = false;
        });
    </script>

</body>
</html>
