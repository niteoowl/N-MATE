<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 / 회원가입</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- wanted-sans 폰트 로드 -->
    <link rel="stylesheet" href="https://fastly.jsdelivr.dev/gh/wanteddev/wanted-sans@v1.0.1/packages/wanted-sans/fonts/webfonts/variable/split/WantedSansVariable.min.css">
    <style>
        :root {
            --bg-primary: #121212;
            --bg-secondary: #1F1F1F;
            --text-primary: #E0E0E0;
            --text-secondary: #A0A0A0;
            --color-blue: #007BFF;
            --border-color: #333333;
            --input-bg: #2d2d2d;
            --input-border: #4a4a4a;
        }

        body {
            font-family: 'WantedSansVariable', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        input {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-primary);
        }

        input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.5); /* --color-blue 사용 */
            border-color: var(--color-blue);
        }

        .toggle-text {
            color: var(--color-blue);
        }
    </style>
</head>
<body class="bg-[--bg-primary]">

    <!-- 메인 컨테이너 -->
    <div class="p-8 md:p-12 w-full max-w-sm">

        <!-- 메시지 박스 -->
        <div id="message-box" class="fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl text-center shadow-lg transition-all duration-300 transform -translate-y-20 opacity-0 z-50"></div>

        <!-- 카드 컴포넌트 -->
        <div class="bg-[--bg-secondary] p-6 sm:p-8 rounded-3xl shadow-lg w-full">

            <!-- 로고/타이틀 -->
            <div class="flex flex-col items-center mb-6">
                <img src="https://i.postimg.cc/XvKJktcP/001-2025-08-01-T220040-650.png" alt="hanilians 로고" class="h-10 md:h-12 w-auto mb-2">
                <p id="form-title" class="text-2xl font-bold text-white mt-4">로그인</p>
            </div>

            <!-- 로그인 폼 -->
            <form id="login-form">
                <div class="mb-4">
                    <label for="login-email" class="block text-sm font-medium text-[--text-secondary] mb-1">이메일</label>
                    <input type="email" id="login-email" name="email" placeholder="hanilians@example.com" required class="w-full px-4 py-2 rounded-xl border-2 border-[--input-border] focus:ring-2 focus:ring-[--color-blue] transition-colors duration-200">
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-sm font-medium text-[--text-secondary] mb-1">비밀번호</label>
                    <input type="password" id="login-password" name="password" placeholder="••••••••" required class="w-full px-4 py-2 rounded-xl border-2 border-[--input-border] focus:ring-2 focus:ring-[--color-blue] transition-colors duration-200">
                </div>
                <button type="submit" class="w-full bg-[--color-blue] text-white font-bold py-3 rounded-xl hover:bg-blue-600 transition-colors duration-200">로그인</button>
            </form>

            <!-- 회원가입 폼 (처음에는 숨김) -->
            <form id="signup-form" class="hidden">
                <div class="mb-4">
                    <label for="signup-email" class="block text-sm font-medium text-[--text-secondary] mb-1">이메일</label>
                    <input type="email" id="signup-email" name="email" placeholder="hanilians@example.com" required class="w-full px-4 py-2 rounded-xl border-2 border-[--input-border] focus:ring-2 focus:ring-[--color-blue] transition-colors duration-200">
                </div>
                <div class="mb-4">
                    <label for="signup-password" class="block text-sm font-medium text-[--text-secondary] mb-1">비밀번호</label>
                    <input type="password" id="signup-password" name="password" placeholder="••••••••" required class="w-full px-4 py-2 rounded-xl border-2 border-[--input-border] focus:ring-2 focus:ring-[--color-blue] transition-colors duration-200">
                </div>
                <div class="mb-6">
                    <label for="confirm-password" class="block text-sm font-medium text-[--text-secondary] mb-1">비밀번호 확인</label>
                    <input type="password" id="confirm-password" name="confirm-password" placeholder="••••••••" required class="w-full px-4 py-2 rounded-xl border-2 border-[--input-border] focus:ring-2 focus:ring-[--color-blue] transition-colors duration-200">
                </div>
                <button type="submit" class="w-full bg-[--color-blue] text-white font-bold py-3 rounded-xl hover:bg-blue-600 transition-colors duration-200">회원가입</button>
            </form>

            <!-- 폼 전환 버튼 -->
            <div class="mt-6 text-center text-sm">
                <span id="toggle-text">계정이 없으신가요?</span>
                <button id="toggle-form-button" class="font-bold toggle-text ml-1 hover:underline">회원가입</button>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK 로드 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Firebase 설정 가져오기
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // DOM 요소 가져오기
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const toggleFormButton = document.getElementById('toggle-form-button');
        const formTitle = document.getElementById('form-title');
        const toggleText = document.getElementById('toggle-text');
        const messageBox = document.getElementById('message-box');

        // 메시지 표시 함수
        function showMessage(text, type) {
            messageBox.textContent = text;
            messageBox.classList.remove('bg-green-500', 'bg-red-500', 'bg-yellow-500');
            messageBox.classList.add('translate-y-0', 'opacity-100');
            
            if (type === 'success') {
                messageBox.classList.add('bg-green-500');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-500');
            } else {
                messageBox.classList.add('bg-yellow-500');
            }

            setTimeout(() => {
                messageBox.classList.remove('translate-y-0', 'opacity-100');
            }, 3000);
        }

        // 로그인 폼 제출 핸들러
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target['login-email'].value;
            const password = e.target['login-password'].value;

            try {
                // Firebase 이메일/비밀번호 로그인
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('로그인 성공:', userCredential.user);
                showMessage('로그인 성공! 환영합니다.', 'success');
                // 로그인 후 메인 페이지로 리디렉션
                window.location.href = '/';
            } catch (error) {
                const errorCode = error.code;
                console.error('로그인 실패:', errorCode, error.message);
                let errorMessage = '로그인에 실패했습니다. 이메일과 비밀번호를 확인해주세요.';
                if (errorCode === 'auth/invalid-email') {
                    errorMessage = '유효하지 않은 이메일 형식입니다.';
                } else if (errorCode === 'auth/user-not-found' || errorCode === 'auth/wrong-password') {
                    errorMessage = '이메일 또는 비밀번호가 올바르지 않습니다.';
                } else if (errorCode === 'auth/too-many-requests') {
                    errorMessage = '너무 많은 로그인 시도가 있었습니다. 잠시 후 다시 시도해주세요.';
                }
                showMessage(errorMessage, 'error');
            }
        });

        // 회원가입 폼 제출 핸들러
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target['signup-email'].value;
            const password = e.target['signup-password'].value;
            const confirmPassword = e.target['confirm-password'].value;

            if (password !== confirmPassword) {
                showMessage('비밀번호가 일치하지 않습니다.', 'error');
                return;
            }

            try {
                // Firebase 이메일/비밀번호 회원가입
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                console.log('회원가입 성공:', userCredential.user);
                showMessage('회원가입 성공! 이제 로그인할 수 있습니다.', 'success');
                // 회원가입 성공 후 메인 페이지로 리디렉션
                window.location.href = '/';
            } catch (error) {
                const errorCode = error.code;
                console.error('회원가입 실패:', errorCode, error.message);
                let errorMessage = '회원가입에 실패했습니다. 다시 시도해주세요.';
                if (errorCode === 'auth/email-already-in-use') {
                    errorMessage = '이미 사용 중인 이메일입니다.';
                } else if (errorCode === 'auth/invalid-email') {
                    errorMessage = '유효하지 않은 이메일 형식입니다.';
                } else if (errorCode === 'auth/weak-password') {
                    errorMessage = '비밀번호는 6자리 이상이어야 합니다.';
                }
                showMessage(errorMessage, 'error');
            }
        });

        // 폼 전환 버튼 핸들러
        toggleFormButton.addEventListener('click', () => {
            const isLoginVisible = !loginForm.classList.contains('hidden');
            loginForm.classList.toggle('hidden');
            signupForm.classList.toggle('hidden');

            if (isLoginVisible) {
                formTitle.textContent = '회원가입';
                toggleText.textContent = '이미 계정이 있으신가요?';
                toggleFormButton.textContent = '로그인';
            } else {
                formTitle.textContent = '로그인';
                toggleText.textContent = '계정이 없으신가요?';
                toggleFormButton.textContent = '회원가입';
            }
        });
    </script>
</body>
</html>
