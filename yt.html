<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Full Screen Player</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* 커스텀 스타일 및 폰트 설정 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Soft Dark Background */
            color: #e5e7eb;
        }
        
        /* 모든 요소에 부드러운 전환 효과 적용 */
        .transition-all-300 {
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 전체 화면 모드일 때 모달이 브라우저 전체를 채우도록 설정 */
        #video-player-modal:fullscreen {
            background-color: #000;
            width: 100%;
            height: 100%;
            padding: 0 !important;
        }

        /* 전체 화면 모드에서 iframe이 화면을 가득 채우도록 스타일 정의 */
        #video-player-modal:fullscreen #video-embed-wrapper {
            width: 100%;
            height: 100%;
            cursor: grab; /* 스와이프/드래그가 가능하다는 표시 */
            position: relative;
        }
        
        /* iOS 스타일의 닫기 핸들 */
        #video-player-modal:fullscreen #close-handle {
            display: block;
            position: absolute;
            top: 10px; /* 상단에서 약간 떨어뜨림 */
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.5); /* 반투명 흰색 */
            border-radius: 2.5px;
            z-index: 60; /* 비디오 위에 위치 */
        }

        #video-player-modal:fullscreen #video-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 비율 유지하며 최대화 */
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-blue-400 mb-2 tracking-tight">
                몰입형 YouTube 플레이어 (ID/URL 입력)
            </h1>
            <p class="text-gray-400 text-sm">YouTube 영상 ID나 URL을 입력하고 전체 화면으로 감상하세요. (종료: ESC, **스와이프/스크롤 다운**)</p>
        </header>

        <!-- Video ID Input (iOS Search Bar Look) -->
        <div class="max-w-2xl mx-auto mb-12">
            <div class="flex space-x-3">
                <input
                    type="text"
                    id="video-id-input"
                    placeholder="YouTube ID, youtu.be/ID 또는 youtube.com/watch?v=ID 를 입력하세요..."
                    class="transition-all-300 flex-grow p-4 bg-gray-800 border border-gray-700 rounded-3xl text-white placeholder-gray-500 focus:ring-4 focus:ring-blue-500 focus:border-blue-500 shadow-lg"
                    onkeydown="if(event.key === 'Enter') handlePlayButtonClick()"
                >
                <button
                    id="play-button"
                    onclick="handlePlayButtonClick()"
                    class="flex-shrink-0 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-3xl shadow-xl transition-all-300 transform hover:scale-[1.02] active:scale-[0.98]"
                >
                    재생
                </button>
            </div>
            <p id="feedback-message" class="text-sm text-red-400 mt-2 ml-4 hidden font-medium">영상 ID 또는 URL을 입력해 주세요.</p>
        </div>
        
        <!-- Placeholder for results/feedback (now only used for spacing) -->
        <div id="main-content-placeholder" class="min-h-64 flex items-center justify-center text-gray-500">
            <p>영상 ID 또는 URL을 입력 후 '재생' 버튼을 눌러주세요.</p>
        </div>

    </div>

    <!-- Full-Screen Video Player Modal - 이 요소가 전체 화면으로 전환됩니다. -->
    <div id="video-player-modal" class="fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-0 transition-all-300 opacity-0 pointer-events-none">
        <div id="video-embed-wrapper" class="w-full h-full flex items-center justify-center">
            <!-- Video will load here along with the close handle -->
        </div>
    </div>

    <script>
        // 상수 및 전역 변수 설정

        const videoIdInput = document.getElementById('video-id-input');
        const feedbackMessage = document.getElementById('feedback-message');
        const videoPlayerModal = document.getElementById('video-player-modal');
        const videoEmbedWrapper = document.getElementById('video-embed-wrapper');
        
        // 스와이프/스크롤 감지 변수
        let isSwiping = false;
        let startY = 0;
        const SWIPE_THRESHOLD = 50; // 전체 화면 종료를 위한 스와이프 거리 (픽셀)
        
        /**
         * YouTube URL 또는 ID에서 11자리의 영상 ID를 추출합니다.
         * @param {string} input - 사용자가 입력한 값 (ID 또는 URL)
         * @returns {string | null} 유효한 영상 ID 또는 null
         */
        function extractVideoId(input) {
            // 정규 표현식을 사용하여 ID를 추출
            // 1. 순수 ID (11자)
            if (/^[a-zA-Z0-9_-]{11}$/.test(input)) {
                return input;
            }

            // 2. 표준 youtube.com/watch?v=ID 형식
            const standardMatch = input.match(/[?&]v=([a-zA-Z0-9_-]{11})(?:&|$)/);
            if (standardMatch && standardMatch[1]) {
                return standardMatch[1];
            }

            // 3. 단축 URL youtu.be/ID 또는 youtube.com/embed/ID 형식
            const shortEmbedMatch = input.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/))([a-zA-Z0-9_-]{11})/);
            if (shortEmbedMatch && shortEmbedMatch[1]) {
                return shortEmbedMatch[1];
            }

            return null;
        }

        /**
         * '재생' 버튼 클릭 시 실행됩니다.
         */
        function handlePlayButtonClick() {
            const inputValue = videoIdInput.value.trim();
            feedbackMessage.classList.add('hidden');

            if (!inputValue) {
                feedbackMessage.textContent = '영상 ID 또는 URL을 입력해 주세요.';
                feedbackMessage.classList.remove('hidden');
                return;
            }

            // URL/ID에서 영상 ID를 추출
            const videoId = extractVideoId(inputValue);

            if (!videoId) {
                feedbackMessage.textContent = '유효한 YouTube 영상 ID 또는 URL이 아닙니다.';
                feedbackMessage.classList.remove('hidden');
                return;
            }
            
            // 영상 재생 시작
            openVideoPlayer(videoId, 'User Provided Video');
        }

        /**
         * 비디오 플레이어를 전체 화면 모드로 열고 영상을 로드
         * @param {string} videoId - 재생할 유튜브 영상 ID
         * @param {string} title - 영상 제목 (접근성을 위해)
         */
        function openVideoPlayer(videoId, title) {
            // 1. 유튜브 임베드 URL: ?autoplay=1을 추가하여 바로 재생되도록 합니다.
            const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&fs=1`;

            // close-handle을 포함하여 내부 HTML을 구성합니다.
            videoEmbedWrapper.innerHTML = `
                <div id="close-handle"></div> 
                <iframe
                    src="${embedUrl}"
                    title="${title} 유튜브 플레이어"
                    class="w-full h-full"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen
                    style="border: none;"
                ></iframe>
            `;
            
            // 2. 모달을 표시
            videoPlayerModal.classList.remove('opacity-0', 'pointer-events-none');

            // 3. 웹 브라우저의 전체 화면 모드 요청
            const element = videoPlayerModal;
            if (element.requestFullscreen) {
                element.requestFullscreen().catch(err => {
                    // 전체 화면 실패 시 오류 메시지 표시 (alert 대신 콘솔에 출력)
                    console.error(`전체 화면 모드 요청 실패: ${err.message} (${err.name}). 보안 정책에 의해 거부되었을 수 있습니다.`);
                });
            }
        }

        /**
         * 비디오 플레이어를 닫음 (전체 화면 모드 종료 포함)
         */
        function closeVideoPlayer() {
            // 1. 현재 전체 화면 모드라면 종료합니다.
            if (document.fullscreenElement) {
                document.exitFullscreen().catch(err => {
                    console.error("전체 화면 종료 실패:", err);
                });
            }

            // 2. 모달 숨기기 및 포인터 이벤트 비활성화
            videoPlayerModal.classList.add('opacity-0', 'pointer-events-none');

            // 3. iframe 내부의 콘텐츠를 제거하여 영상 재생을 중지합니다.
            videoEmbedWrapper.innerHTML = '';
            // 스와이프/스크롤 상태 초기화
            videoEmbedWrapper.style.transform = 'translateY(0)';
        }

        /* ------------------ 스와이프/드래그/스크롤 전체 화면 종료 로직 ------------------ */

        /**
         * 스와이프/드래그 시작 핸들러 (마우스/터치)
         */
        function handleSwipeStart(event) {
            if (!document.fullscreenElement) return; // 전체 화면이 아니면 무시

            isSwiping = true;
            // 터치 이벤트는 touches[0].clientY, 마우스 이벤트는 clientY 사용
            startY = event.touches ? event.touches[0].clientY : event.clientY;
            videoEmbedWrapper.style.cursor = 'grabbing'; // 드래그 중인 커서 표시
        }

        /**
         * 스와이프/드래그 이동 핸들러 (마우스/터치)
         */
        function handleSwipeMove(event) {
            if (!isSwiping || !document.fullscreenElement) return;

            const currentY = event.touches ? event.touches[0].clientY : event.clientY;
            const deltaY = currentY - startY;

            // 스와이프 다운 (deltaY > 0)일 때만 처리
            if (deltaY > 0) {
                // 시각적인 피드백 (모달을 아래로 살짝 이동시켜 해제 임박을 알림)
                videoEmbedWrapper.style.transform = `translateY(${deltaY}px)`;
                
                // 임계값을 넘으면 닫기
                if (deltaY > SWIPE_THRESHOLD) {
                    closeVideoPlayer();
                    handleSwipeEnd(); // 종료 후 이벤트 리셋
                }
            } else {
                // 위로 스와이프는 무시
                 videoEmbedWrapper.style.transform = 'translateY(0)';
            }
        }

        /**
         * 스와이프/드래그 종료 핸들러 (마우스/터치)
         */
        function handleSwipeEnd() {
            isSwiping = false;
            videoEmbedWrapper.style.cursor = 'grab'; // 커서 복원
            
            // 스와이프 임계값에 도달하지 못했다면 원래 위치로 부드럽게 복원
            if (document.fullscreenElement) {
                videoEmbedWrapper.style.transform = 'translateY(0)'; 
            }
        }

        /**
         * PC 스크롤 (마우스 휠/터치패드) 이벤트 핸들러
         */
        function handleWheel(event) {
            if (!document.fullscreenElement) return;

            // 스크롤 다운 (deltaY가 양수)
            if (event.deltaY > 0) {
                // 스크롤 틱이 감지되면 (deltaY 값은 브라우저 환경마다 다름)
                if (Math.abs(event.deltaY) > 5) {
                    closeVideoPlayer();
                }
            }
            // 스크롤이 발생할 때 iframe 내부 요소까지 스크롤되는 것을 막아 
            // 제스처가 플레이어 닫기에만 집중되도록 합니다.
            event.preventDefault(); 
        }


        // 이벤트 리스너 등록
        function setupEventListeners() {
            // 전체 화면 상태 변경 감지 리스너: 사용자가 ESC 키 등으로 전체 화면을 종료했을 때
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) {
                    // 영상 재생을 중지하고 모달을 숨깁니다.
                    videoPlayerModal.classList.add('opacity-0', 'pointer-events-none');
                    videoEmbedWrapper.innerHTML = '';
                }
            });

            // 스와이프/드래그/스크롤 이벤트 리스너 (videoEmbedWrapper에 추가)
            
            // 1. 마우스 드래그 (스와이프 대체)
            videoEmbedWrapper.addEventListener('mousedown', handleSwipeStart);
            videoEmbedWrapper.addEventListener('mousemove', handleSwipeMove);
            videoEmbedWrapper.addEventListener('mouseup', handleSwipeEnd);
            videoEmbedWrapper.addEventListener('mouseleave', handleSwipeEnd);

            // 2. 터치 스와이프
            videoEmbedWrapper.addEventListener('touchstart', handleSwipeStart, { passive: true });
            videoEmbedWrapper.addEventListener('touchmove', handleSwipeMove, { passive: false }); // passive: false로 설정하여 preventDefault를 허용합니다.
            videoEmbedWrapper.addEventListener('touchend', handleSwipeEnd);
            videoEmbedWrapper.addEventListener('touchcancel', handleSwipeEnd);
            
            // 3. PC 스크롤 (휠 이벤트)
            videoEmbedWrapper.addEventListener('wheel', handleWheel, { passive: false });
        }

        // 초기 로드 시 이벤트 리스너 설정
        window.onload = setupEventListeners;

    </script>
</body>
</html>
