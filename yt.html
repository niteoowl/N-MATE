<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>유튜브 전체화면 시뮬레이터 (모바일 최적화)</title>
    <!-- YouTube 다크 모드 테마 및 모바일 친화적인 CSS -->
    <style>
        /* YouTube Dark Theme Colors */
        :root {
            --color-bg-primary: #0f0f0f; /* YouTube Main Background */
            --color-bg-secondary: #181818; /* Card/Surface Background */
            --color-text: #ffffff; /* Primary Text */
            --color-text-sub: #aaaaaa; /* Subdued Text */
            --color-accent-red: #ff0000; /* YouTube Red */
            --color-button-bg: #303030;
            --color-button-hover: #4a4a4a;
            --color-success: #4CAF50;
            --border-radius: 6px;
            --font-family: 'Roboto', 'Noto Sans KR', sans-serif;
        }

        body {
            background-color: var(--color-bg-primary);
            color: var(--color-text);
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* 메인 컨테이너 - 모바일 대응 */
        .container {
            width: 90%;
            max-width: 700px;
            padding: 20px;
            background: var(--color-bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            margin: 20px 0;
        }

        h1 {
            color: var(--color-text);
            font-size: 1.6rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        h2 {
            color: var(--color-text);
            font-size: 1.1rem;
            margin-top: 25px;
            margin-bottom: 10px;
            font-weight: 500;
            border-bottom: 1px solid var(--color-button-bg);
            padding-bottom: 5px;
        }

        p {
            color: var(--color-text-sub);
            margin-bottom: 15px;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        /* 입력 및 버튼 그룹 */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: stretch;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 10px 12px;
            border: 1px solid var(--color-button-bg);
            background-color: var(--color-bg-primary);
            color: var(--color-text);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-accent-red);
            box-shadow: 0 0 0 1px var(--color-accent-red);
        }

        /* 버튼 스타일 */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        .btn-primary { /* 재생 버튼 */
            background-color: var(--color-accent-red);
            color: var(--color-text);
        }

        .btn-primary:hover {
            background-color: #cc0000;
        }

        .btn-secondary { /* 검색 버튼 */
            background-color: var(--color-button-bg);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background-color: var(--color-button-hover);
        }

        /* 전체화면 모드 스타일 */
        #fullscreen-player {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background-color: black;
        }

        #player-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* 메시지/안내 박스 */
        #message-box {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            font-weight: 500;
            font-size: 0.85rem;
            text-align: left;
        }
        
        #message-box p {
            margin: 5px 0;
        }

        .warning-text {
            color: var(--color-accent-red);
            font-weight: 700;
        }

        .success-text {
            color: var(--color-success);
            font-weight: 700;
        }
        
        /* 로딩 스피너 (스타일은 유지) */
        .loader {
            border: 3px solid var(--color-button-bg);
            border-top: 3px solid var(--color-accent-red);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            margin: auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 모바일 레이아웃 (768px 이하) - 반응형 유지 */
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                padding: 15px;
                border-radius: 0;
                box-shadow: none;
            }

            .input-group {
                flex-direction: column; /* 작은 화면에서 세로로 쌓기 */
                gap: 8px;
            }

            button {
                width: 100%; /* 버튼 전체 너비 사용 */
                padding: 12px 15px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="container" id="main-content">
        <h1>YouTube 전체화면 시뮬레이터</h1>
        <p>
            **API 없이** 구형/모바일 브라우저에서 전체화면을 시뮬레이션하고 백그라운드 재생을 시도합니다.
        </p>

        <!-- 1. 영상 검색 (API 우회) -->
        <h2>1. 영상 검색 (새 창)</h2>
        <div class="input-group">
            <input type="text" id="search-query" placeholder="검색어를 입력하세요">
            <button class="btn-secondary" onclick="openYouTubeSearch()">YouTube 검색</button>
        </div>
        <p style="font-size: 0.8rem; color: var(--color-text-sub); margin-bottom: 20px;">
            새 창에서 영상을 찾고 URL을 복사하여 아래에 붙여넣으세요.
        </p>


        <!-- 2. URL/ID 입력 및 전체 화면 재생 -->
        <h2>2. 영상 재생</h2>
        <div class="input-group">
            <input type="text" id="video-input" placeholder="YouTube 영상 URL 또는 ID를 붙여넣으세요.">
            <button class="btn-primary" onclick="loadAndPlayVideo()">
                <span id="play-button-text">▶ 재생 및 전체화면 시작</span>
                <div class="loader" id="loading-spinner"></div>
            </button>
        </div>
        
        <div id="message-box">
            <!-- 초기 메시지는 스크립트에서 설정됨 -->
        </div>

    </div>

    <!-- 3. 전체 화면 시뮬레이션 Player -->
    <div id="fullscreen-player">
        <!-- allow="autoplay"는 모바일 백그라운드 재생 가능성을 높여줍니다. -->
        <iframe id="player-iframe" 
                src="" 
                allow="autoplay; accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
        </iframe>
    </div>

    <script>
        // 전역 변수
        const mainContent = document.getElementById('main-content');
        const fullscreenPlayer = document.getElementById('fullscreen-player');
        const playerIframe = document.getElementById('player-iframe');
        const videoInput = document.getElementById('video-input');
        const messageBox = document.getElementById('message-box');
        const loadingSpinner = document.getElementById('loading-spinner');
        const playButtonText = document.getElementById('play-button-text');

        // 기본 안내 메시지 (모바일 종료 방식 명확히 수정)
        const initialMessage = `
            <p><span class="warning-text">✅ 종료 안내:</span> PC는 **ESC 키**, 모바일은 **브라우저의 '뒤로 가기'** 버튼 또는 제스처를 사용하세요. (별도 종료 버튼 없음)</p>
            <p><span class="warning-text">⚠️ 백그라운드 재생:</span> <span class="success-text">최대한 지원되도록 설정되었으나, 브라우저 정책에 따라 제한될 수 있습니다.</span></p>
            <p><span class="warning-text">⚠️ 중요:</span> 플레이어 내 추천 동영상 클릭 시 새 영상은 **재생되지 않습니다.** (API 제약)</p>
        `;

        function showStatus(msg, isError = true) {
            // 새로운 상태 메시지를 위에 잠시 표시
            const statusHtml = isError 
                ? `<p class="warning-text">${msg}</p>`
                : `<p class="success-text">${msg}</p>`;
            
            messageBox.innerHTML = statusHtml + initialMessage;

            // 3초 후 기본 안내 메시지로 복구
            setTimeout(() => {
                messageBox.innerHTML = initialMessage;
            }, 3000);
        }

        function toggleLoading(isLoading) {
            loadingSpinner.style.display = isLoading ? 'block' : 'none';
            playButtonText.style.display = isLoading ? 'none' : 'inline';
        }

        // 1. 영상 검색 (API 우회)
        function openYouTubeSearch() {
            const query = document.getElementById('search-query').value.trim();
            if (query) {
                const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
                window.open(searchUrl, '_blank');
            } else {
                showStatus("검색어를 입력해주세요.", false);
            }
        }

        // 2. YouTube ID 추출 함수
        function extractVideoId(input) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = input.match(regex);
            
            if (match && match[1]) {
                return match[1];
            }

            if (input.length === 11 && /^[a-zA-Z0-9_-]{11}$/.test(input)) {
                return input;
            }

            return null;
        }

        // 3. 전체 화면 종료 함수
        function exitFullscreen() {
            if (fullscreenPlayer.style.display === 'block') {
                fullscreenPlayer.style.display = 'none';
                mainContent.style.display = 'block';

                // 재생 중이던 영상 정지
                playerIframe.src = '';
                
                videoInput.focus();

                showStatus("전체화면 재생이 종료되었습니다. 새로운 영상을 입력하세요.", false);
            }
        }
        
        // 4. 영상 로드 및 전체 화면 시뮬레이션
        function loadAndPlayVideo() {
            const input = videoInput.value.trim();
            
            if (!input) {
                showStatus("YouTube URL 또는 영상 ID를 입력해주세요.");
                return;
            }

            const videoId = extractVideoId(input);

            if (!videoId) {
                showStatus("유효한 YouTube URL 또는 11자리 영상 ID가 아닙니다.");
                return;
            }

            toggleLoading(true);

            // 임베드 URL: autoplay=1 (자동 재생), controls=1
            const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&modestbranding=1`;

            playerIframe.src = embedUrl;

            // 모바일/PC 뒤로 가기 종료 기능을 위해 history state를 추가
            // 사용자가 '뒤로 가기'를 누르면 popstate 이벤트가 발생하여 exitFullscreen이 호출됨
            history.pushState({ screen: 'fullscreen' }, 'Fullscreen Player');

            // 로드 대기 후 화면 전환
            setTimeout(() => {
                toggleLoading(false);
                mainContent.style.display = 'none';
                fullscreenPlayer.style.display = 'block';
                playerIframe.focus(); 
                showStatus("전체화면 재생을 시작합니다. 모바일 '뒤로 가기'로 종료하세요.", false);
            }, 300); 
        }

        // PC용 종료: ESC 키 리스너 등록
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && fullscreenPlayer.style.display === 'block') {
                // history state를 하나 제거하여 popstate가 호출되지 않도록 방지
                history.back(); 
                // exitFullscreen을 직접 호출하지 않고 popstate 이벤트를 기다림
            }
        });

        // 모바일용 종료: '뒤로 가기' (popstate) 리스너 등록
        window.addEventListener('popstate', (event) => {
            // 전체화면 상태일 때만 종료를 실행
            if (fullscreenPlayer.style.display === 'block') {
                exitFullscreen();
                // popstate 이벤트 발생 후 한 번 더 history.pushState를 호출하여
                // 사용자가 한 번 더 뒤로 가기를 눌러도 브라우저를 완전히 이탈하지 않도록 방지
                history.pushState(null, '', location.pathname); 
            }
        });

        // 초기 로드 시 메시지 설정
        document.addEventListener('DOMContentLoaded', () => {
             messageBox.innerHTML = initialMessage;
        });

    </script>
</body>
</html>
