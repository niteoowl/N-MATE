<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTube Ultimate App</title>
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" />
    
    <style>
        /* --- 1. CSS Reset & Variables --- */
        :root {
            --bg-color: #0f0f0f;
            --header-bg: rgba(15, 15, 15, 0.98);
            --text-main: #fff;
            --text-sub: #aaa;
            --accent: #fff;
            --nav-height: 48px;
            --bottom-nav-height: 50px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); color: var(--text-main); overflow: hidden; height: 100vh; width: 100vw; }
        
        /* ìœ í‹¸ë¦¬í‹° */
        .material-symbols-outlined { font-size: 24px; color: #fff; user-select: none; }
        .filled { font-variation-settings: 'FILL' 1; }
        .hidden { display: none !important; }
        button { background: none; border: none; cursor: pointer; color: inherit; }

        /* --- 2. í˜ì´ì§€ ì „í™˜ ì‹œìŠ¤í…œ (SPA ëŠë‚Œ) --- */
        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); overflow-y: auto;
            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
            padding-top: var(--nav-height); /* í—¤ë” ë†’ì´ë§Œí¼ ë„ì›€ */
            padding-bottom: var(--bottom-nav-height);
            z-index: 10;
        }
        
        /* ê¸°ë³¸ ìƒíƒœ: í™ˆì€ ë³´ì„ */
        #home-page { z-index: 10; }
        
        /* ì±„ë„ í˜ì´ì§€: ì˜¤ë¥¸ìª½ì—ì„œ ìŠ¬ë¼ì´ë“œ */
        #channel-page { 
            transform: translateX(100%); 
            z-index: 20; 
            padding-top: 0; /* ì±„ë„ í˜ì´ì§€ëŠ” í—¤ë”ê°€ ë‹¤ë¦„ */
        }
        #channel-page.active { transform: translateX(0); }

        /* ì¬ìƒ í˜ì´ì§€: ì•„ë˜ì—ì„œ ìŠ¬ë¼ì´ë“œ */
        #watch-page {
            transform: translateY(100%);
            z-index: 50;
            padding: 0;
            background: #000;
        }
        #watch-page.active { transform: translateY(0); }

        /* --- 3. í—¤ë” --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--nav-height);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 12px; z-index: 100; background-color: var(--header-bg);
        }
        .logo-section { display: flex; align-items: center; gap: 4px; }
        .yt-icon { color: #f00; font-size: 28px; }
        .yt-text { font-weight: 700; font-size: 20px; letter-spacing: -1px; }

        /* --- 4. í™ˆí™”ë©´ êµ¬ì„± --- */
        .chips-bar {
            display: flex; gap: 8px; padding: 8px 12px; overflow-x: auto;
            position: sticky; top: 0; background: var(--bg-color); z-index: 90;
        }
        .chips-bar::-webkit-scrollbar { display: none; }
        .chip {
            background: #272727; padding: 6px 12px; border-radius: 8px; white-space: nowrap; font-size: 14px; font-weight: 500;
        }
        .chip.active { background: #fff; color: #000; }

        .video-card { margin-bottom: 20px; cursor: pointer; }
        .thumb-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #222; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .duration { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); padding: 2px 4px; border-radius: 4px; font-size: 12px; font-weight: 500;}
        
        .info-row { display: flex; padding: 12px 12px 0; }
        .avatar { width: 36px; height: 36px; border-radius: 50%; background: #333; margin-right: 12px; overflow: hidden; flex-shrink: 0; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        .details { flex: 1; padding-right: 10px; }
        .title { font-size: 16px; font-weight: 500; line-height: 1.3; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta { font-size: 12px; color: var(--text-sub); }

        /* --- 5. ì±„ë„ í˜ì´ì§€ --- */
        /* ì±„ë„ í—¤ë”ëŠ” íˆ¬ëª…í•˜ë‹¤ê°€ ìŠ¤í¬ë¡¤ì‹œ ìƒ‰ì´ ìƒê¸°ëŠ” ì•± ìŠ¤íƒ€ì¼ í‰ë‚´ (ì—¬ê¸°ì„  ê³ ì •ìƒ‰) */
        .channel-nav {
            position: absolute; top: 0; width: 100%; height: 50px; 
            display: flex; align-items: center; padding: 0 10px; gap: 20px;
            background: rgba(0,0,0,0.3); z-index: 5;
        }
        .channel-banner { width: 100%; height: 16vw; min-height: 80px; background: #333; object-fit: cover; }
        .channel-info { padding: 16px; display: flex; flex-direction: column; align-items: center; text-align: center;}
        .channel-big-avatar { width: 72px; height: 72px; border-radius: 50%; border: 2px solid #0f0f0f; margin-top: -40px; background: #333; z-index: 2; overflow: hidden;}
        .channel-big-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .ch-name { font-size: 22px; font-weight: 700; margin-top: 8px; }
        .ch-stats { font-size: 12px; color: var(--text-sub); margin-top: 4px; }
        
        .sub-btn-large {
            background: #fff; color: #0f0f0f; font-weight: 600; padding: 8px 32px; border-radius: 20px; margin-top: 12px; font-size: 14px;
        }

        /* --- 6. ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ --- */
        .player-container {
            width: 100%; aspect-ratio: 16/9; background: #000; position: sticky; top: 0; z-index: 100;
        }
        /* ì‹¤ì œ ìœ íŠœë¸Œ iframeì€ ìˆ¨ê¸°ê³ (íˆ¬ëª…í™” ë“±) ìœ„ì— UIë¥¼ ë®ê±°ë‚˜, APIë¡œ ì œì–´ */
        #yt-player-iframe { width: 100%; height: 100%; pointer-events: none; } /* í´ë¦­ ë°©ì§€í•˜ì—¬ ì»¤ìŠ¤í…€ UI ê°•ì œ */
        
        /* ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ ë ˆì´ì–´ */
        .custom-controls {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); 
            display: flex; flex-direction: column; justify-content: space-between;
            opacity: 0; transition: opacity 0.3s;
            pointer-events: auto;
        }
        /* í„°ì¹˜ ì‹œ ì»¨íŠ¸ë¡¤ ë³´ì´ê¸° */
        .player-container:hover .custom-controls, 
        .player-container.show-controls .custom-controls { opacity: 1; }

        .ctrl-top { display: flex; justify-content: space-between; padding: 12px; }
        .ctrl-mid { display: flex; justify-content: center; align-items: center; gap: 40px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .ctrl-btn { color: white; font-size: 48px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }
        
        .ctrl-bottom { padding: 12px; display: flex; align-items: center; gap: 10px; font-size: 12px; font-weight: 500;}
        .progress-bar { flex: 1; height: 3px; background: rgba(255,255,255,0.3); position: relative; border-radius: 2px; }
        .progress-fill { height: 100%; background: #f00; width: 0%; border-radius: 2px; position: relative;}
        .progress-fill::after { content:''; position:absolute; right:-6px; top:-4px; width:12px; height:12px; background:#f00; border-radius:50%; }

        .watch-details { padding: 12px; }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loader { text-align: center; padding: 40px; color: #666; }

    </style>
</head>
<body>

    <!-- ìœ íŠœë¸Œ API ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- 1. í—¤ë” (í™ˆ ì „ìš©) -->
    <header id="main-header">
        <div class="logo-section" onclick="goHome()">
            <span class="material-symbols-outlined filled yt-icon">play_arrow</span>
            <span class="yt-text">YouTube</span>
        </div>
        <div style="display:flex; gap:16px;">
            <span class="material-symbols-outlined">cast</span>
            <span class="material-symbols-outlined">notifications</span>
            <span class="material-symbols-outlined">search</span>
        </div>
    </header>

    <!-- 2. í™ˆ í˜ì´ì§€ -->
    <div id="home-page" class="page">
        <div class="chips-bar">
            <div class="chip active">ì „ì²´</div>
            <div class="chip">ìƒˆë¡œìš´ ë§ì¶¤ ë™ì˜ìƒ</div>
            <div class="chip">ê²Œì„</div>
            <div class="chip">ìŒì•…</div>
            <div class="chip">ë¼ì´ë¸Œ</div>
        </div>
        <div id="home-video-list">
            <div class="loader">ë¡œë”© ì¤‘...</div>
        </div>
    </div>

    <!-- 3. ì±„ë„ í˜ì´ì§€ -->
    <div id="channel-page" class="page">
        <div class="channel-nav">
            <button onclick="closeChannel()"><span class="material-symbols-outlined">arrow_back</span></button>
            <span style="flex:1;"></span>
            <span class="material-symbols-outlined">more_vert</span>
        </div>
        <img id="ch-banner" class="channel-banner" src="" alt="">
        <div class="channel-info">
            <div class="channel-big-avatar">
                <img id="ch-avatar-lg" src="" alt="">
            </div>
            <div class="ch-name" id="ch-title">Channel Name</div>
            <div class="ch-stats" id="ch-subs">êµ¬ë…ì ë¡œë”©ì¤‘...</div>
            <button class="sub-btn-large">êµ¬ë…</button>
        </div>
        <!-- ì±„ë„ íƒ­ -->
        <div class="chips-bar" style="border-bottom:1px solid #222;">
            <div class="chip active" style="background:none; color:#fff; border-bottom:2px solid #fff; border-radius:0;">í™ˆ</div>
            <div class="chip" style="background:none; color:#aaa;">ë™ì˜ìƒ</div>
            <div class="chip" style="background:none; color:#aaa;">Shorts</div>
            <div class="chip" style="background:none; color:#aaa;">ì¬ìƒëª©ë¡</div>
        </div>
        <!-- ì±„ë„ ë¹„ë””ì˜¤ ë¦¬ìŠ¤íŠ¸ -->
        <div id="channel-video-list" style="padding-top:10px;">
            <div class="loader">ë™ì˜ìƒ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <!-- 4. ì¬ìƒ í˜ì´ì§€ (ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ í¬í•¨) -->
    <div id="watch-page" class="page">
        <!-- ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ ì˜ì—­ -->
        <div class="player-container" id="player-container" onclick="toggleControls()">
            <!-- APIê°€ ì—¬ê¸°ì— iframeì„ ì‹¬ìŠµë‹ˆë‹¤ -->
            <div id="yt-player-placeholder"></div>
            
            <!-- ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ ì˜¤ë²„ë ˆì´ -->
            <div class="custom-controls" id="custom-controls">
                <div class="ctrl-top">
                    <span class="material-symbols-outlined" onclick="closePlayer(event)">keyboard_arrow_down</span>
                    <span class="material-symbols-outlined">settings</span>
                </div>
                <div class="ctrl-mid">
                    <span class="material-symbols-outlined ctrl-btn" onclick="seek(-10, event)">replay_10</span>
                    <span class="material-symbols-outlined ctrl-btn" id="play-pause-btn" style="font-size:64px;" onclick="togglePlay(event)">pause_circle</span>
                    <span class="material-symbols-outlined ctrl-btn" onclick="seek(10, event)">forward_10</span>
                </div>
                <div class="ctrl-bottom">
                    <span id="cur-time">0:00</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="prog-fill"></div>
                    </div>
                    <span id="total-time">0:00</span>
                    <span class="material-symbols-outlined">fullscreen</span>
                </div>
            </div>
        </div>

        <!-- ì˜ìƒ ì •ë³´ -->
        <div class="watch-details">
            <h2 id="wp-title" style="font-size:18px; font-weight:700; margin-bottom:8px;">ì œëª©</h2>
            <div class="info-row" style="padding:0; margin-bottom:12px; align-items: center;">
                <div class="meta" id="wp-view-count" style="flex:1;">ì¡°íšŒìˆ˜ â€¢ ì‹œê°„</div>
            </div>
            
            <!-- ì±„ë„ í–‰ -->
            <div style="display:flex; align-items:center; justify-content:space-between; padding:8px 0; border-top:1px solid #222; border-bottom:1px solid #222;">
                <div style="display:flex; align-items:center; gap:10px;" onclick="goToChannelFromPlayer()">
                    <div class="avatar"><img id="wp-channel-img" src=""></div>
                    <div>
                        <div id="wp-channel-name" style="font-weight:700; font-size:14px;">ì±„ë„ëª…</div>
                        <div style="font-size:12px; color:#aaa;">êµ¬ë…ì 100ë§Œëª…</div>
                    </div>
                </div>
                <div style="background:#fff; color:#000; padding:6px 16px; border-radius:18px; font-size:14px; font-weight:600;">êµ¬ë…</div>
            </div>

            <!-- ëŒ“ê¸€ ë¯¸ë¦¬ë³´ê¸° -->
            <div style="margin-top:16px; background:#222; padding:12px; border-radius:12px;">
                <div style="font-size:12px; font-weight:bold; margin-bottom:4px;">ëŒ“ê¸€</div>
                <div style="font-size:13px;">ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ ë””ìì¸ ì§„ì§œ ê¹”ë”í•˜ë„¤ìš”! ğŸ‘</div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë‚´ë¹„ê²Œì´ì…˜ -->
    <nav style="position:fixed; bottom:0; width:100%; height:50px; background:#0f0f0f; border-top:1px solid #222; display:flex; justify-content:space-around; align-items:center; z-index:100;">
        <div class="nav-item" onclick="goHome()" style="text-align:center; color:#fff;">
            <span class="material-symbols-outlined filled">home</span>
            <div style="font-size:10px;">í™ˆ</div>
        </div>
        <div class="nav-item" style="text-align:center; color:#fff;">
            <span class="material-symbols-outlined">slow_motion_video</span>
            <div style="font-size:10px;">Shorts</div>
        </div>
        <div class="nav-item" style="text-align:center; color:#fff;">
            <span class="material-symbols-outlined" style="font-size:32px;">add_circle</span>
        </div>
        <div class="nav-item" style="text-align:center; color:#fff;">
            <span class="material-symbols-outlined">subscriptions</span>
            <div style="font-size:10px;">êµ¬ë…</div>
        </div>
        <div class="nav-item" style="text-align:center; color:#fff;">
            <span class="material-symbols-outlined">account_circle</span>
            <div style="font-size:10px;">ë‚˜</div>
        </div>
    </nav>

    <script>
        const API_KEY = 'AIzaSyD9gpmEbUyP9h9Rm3nayK7PLYek5Ja7B38'; 
        
        let player; // ìœ íŠœë¸Œ í”Œë ˆì´ì–´ ê°ì²´
        let playerInterval; // ì§„í–‰ë°” ì—…ë°ì´íŠ¸ìš©
        let currentChannelId = ''; // í˜„ì¬ ë³´ê³  ìˆëŠ” ì±„ë„ ID

        // --- 1. ì´ˆê¸° ë°ì´í„° ë¡œë“œ ---
        window.onload = loadPopularVideos;

        async function loadPopularVideos() {
            const list = document.getElementById('home-video-list');
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&maxResults=10&regionCode=KR&key=${API_KEY}`);
                const data = await res.json();
                renderVideoList(data.items, list, false);
            } catch (e) {
                list.innerHTML = '<div style="padding:20px; text-align:center;">API í•œë„ ì´ˆê³¼ ë˜ëŠ” ì˜¤ë¥˜</div>';
            }
        }

        // --- 2. ë¹„ë””ì˜¤ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ê³µí†µ) ---
        function renderVideoList(items, container, isChannel = false) {
            container.innerHTML = '';
            items.forEach(item => {
                // ì±„ë„ ë¦¬ìŠ¤íŠ¸ í˜¸ì¶œ(search)ì¼ ê²½ìš° idê°€ ê°ì²´ì„
                const videoId = item.id.videoId || item.id; 
                const snippet = item.snippet;
                const channelId = snippet.channelId;
                
                // ì±„ë„ í”„ì‚¬ëŠ” ë³„ë„ API í˜¸ì¶œ í•„ìš”í•˜ë‚˜ API ì ˆì•½ì„ ìœ„í•´ ëœë¤/í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš©
                // (ì‹¤ì œ ì•±ì—ì„  items IDë¥¼ ëª¨ì•„ì„œ channel API í•œë²ˆ ë” í˜¸ì¶œí•¨)
                
                const div = document.createElement('div');
                div.className = 'video-card';
                // ì¸ë„¤ì¼ í´ë¦­ -> ì¬ìƒ
                // ì±„ë„ í”„ì‚¬ í´ë¦­ -> ì±„ë„ í˜ì´ì§€
                div.innerHTML = `
                    <div class="thumb-box" onclick="openPlayer('${videoId}', '${escapeHtml(snippet.title)}', '${channelId}', '${escapeHtml(snippet.channelTitle)}')">
                        <img src="${snippet.thumbnails.medium.url}" loading="lazy">
                        <div class="duration">ì˜ìƒ</div>
                    </div>
                    <div class="info-row">
                        ${!isChannel ? `
                        <div class="avatar" onclick="openChannel('${channelId}')">
                            <img src="https://ui-avatars.com/api/?name=${snippet.channelTitle}&background=random">
                        </div>` : ''}
                        <div class="details" onclick="openPlayer('${videoId}', '${escapeHtml(snippet.title)}', '${channelId}', '${escapeHtml(snippet.channelTitle)}')">
                            <div class="title">${snippet.title}</div>
                            <div class="meta">${snippet.channelTitle} â€¢ ${timeAgo(snippet.publishedAt)}</div>
                        </div>
                        <span class="material-symbols-outlined" style="font-size:20px; color:#aaa;">more_vert</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // --- 3. ì±„ë„ í˜ì´ì§€ ë¡œì§ ---
        async function openChannel(channelId) {
            currentChannelId = channelId;
            document.getElementById('channel-page').classList.add('active');
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            document.getElementById('ch-title').innerText = "ë¡œë”© ì¤‘...";
            document.getElementById('channel-video-list').innerHTML = '<div class="loader">...</div>';

            try {
                // A. ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const chRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${API_KEY}`);
                const chData = await chRes.json();
                const chItem = chData.items[0];

                document.getElementById('ch-title').innerText = chItem.snippet.title;
                document.getElementById('ch-subs').innerText = `êµ¬ë…ì ${formatCount(chItem.statistics.subscriberCount)}ëª… â€¢ ë™ì˜ìƒ ${chItem.statistics.videoCount}ê°œ`;
                document.getElementById('ch-avatar-lg').src = chItem.snippet.thumbnails.medium.url;
                
                // ë°°ë„ˆ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
                const bannerUrl = chItem.brandingSettings?.image?.bannerExternalUrl || 'https://via.placeholder.com/800x200/333/fff?text=No+Banner';
                document.getElementById('ch-banner').src = bannerUrl;

                // B. ì±„ë„ì˜ ìµœì‹  ì˜ìƒ ê°€ì ¸ì˜¤ê¸° (Search API)
                const vidRes = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&order=date&maxResults=10&type=video&key=${API_KEY}`);
                const vidData = await vidRes.json();
                
                renderVideoList(vidData.items, document.getElementById('channel-video-list'), true);

            } catch (e) {
                console.error(e);
            }
        }

        function closeChannel() {
            document.getElementById('channel-page').classList.remove('active');
        }

        function goHome() {
            document.getElementById('channel-page').classList.remove('active');
            closePlayer();
        }

        // --- 4. ì»¤ìŠ¤í…€ í”Œë ˆì´ì–´ ë¡œì§ (YouTube IFrame API) ---
        
        // IFrame API ì¤€ë¹„ ì™„ë£Œ ì‹œ í˜¸ì¶œë¨
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('yt-player-placeholder', {
                height: '100%',
                width: '100%',
                videoId: '', // ì´ˆê¸°ì—” ë¹„ì–´ìˆìŒ
                playerVars: {
                    'playsinline': 1,
                    'controls': 0, // ê¸°ë³¸ ì»¨íŠ¸ë¡¤ ìˆ¨ê¹€ (í•µì‹¬)
                    'rel': 0,
                    'modestbranding': 1,
                    'fs': 0,
                    'iv_load_policy': 3,
                    'disablekb': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            // í”Œë ˆì´ì–´ ì¤€ë¹„ë¨
        }

        function onPlayerStateChange(event) {
            const btn = document.getElementById('play-pause-btn');
            if (event.data == YT.PlayerState.PLAYING) {
                btn.innerText = 'pause_circle';
                startProgressLoop();
                // ì¬ìƒ ì‹œì‘ ì‹œ ì»¨íŠ¸ë¡¤ ìˆ¨ê¸°ê¸° (3ì´ˆ ë’¤)
                setTimeout(() => {
                   document.getElementById('player-container').classList.remove('show-controls');
                }, 2500);
            } else {
                btn.innerText = 'play_circle';
                stopProgressLoop();
                document.getElementById('player-container').classList.add('show-controls');
            }
        }

        // í”Œë ˆì´ì–´ UI ì—´ê¸°
        function openPlayer(videoId, title, channelId, channelName) {
            // UI ì„¸íŒ…
            document.getElementById('watch-page').classList.add('active');
            document.getElementById('wp-title').innerText = title;
            document.getElementById('wp-channel-name').innerText = channelName;
            document.getElementById('wp-channel-img').src = `https://ui-avatars.com/api/?name=${channelName}&background=random`;
            
            // í”Œë ˆì´ì–´ ë¡œë“œ
            if (player && player.loadVideoById) {
                player.loadVideoById(videoId);
            } else {
                // API ë¡œë“œ ì „ì´ë©´ ì ì‹œ ëŒ€ê¸° í›„ ì‹œë„ (ê°„ëµí™”)
                setTimeout(() => openPlayer(videoId, title, channelId, channelName), 500);
            }

            // ì±„ë„ ì´ë™ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ì„¤ì •
            currentChannelId = channelId;
        }

        function closePlayer(e) {
            if(e) e.stopPropagation();
            document.getElementById('watch-page').classList.remove('active');
            if(player && player.stopVideo) player.stopVideo();
        }

        // ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ ê¸°ëŠ¥
        function togglePlay(e) {
            e.stopPropagation();
            if(player.getPlayerState() == YT.PlayerState.PLAYING) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function seek(sec, e) {
            e.stopPropagation();
            const cur = player.getCurrentTime();
            player.seekTo(cur + sec, true);
        }

        function toggleControls() {
            const container = document.getElementById('player-container');
            container.classList.toggle('show-controls');
        }

        // ì§„í–‰ë°” ì—…ë°ì´íŠ¸
        function startProgressLoop() {
            stopProgressLoop();
            playerInterval = setInterval(() => {
                if(!player || !player.getCurrentTime) return;
                const cur = player.getCurrentTime();
                const total = player.getDuration();
                
                if(total > 0) {
                    const pct = (cur / total) * 100;
                    document.getElementById('prog-fill').style.width = pct + '%';
                    document.getElementById('cur-time').innerText = formatTime(cur);
                    document.getElementById('total-time').innerText = formatTime(total);
                }
            }, 500);
        }

        function stopProgressLoop() {
            if(playerInterval) clearInterval(playerInterval);
        }

        // í”Œë ˆì´ì–´ í™”ë©´ì—ì„œ ì±„ë„ë¡œ ì´ë™
        function goToChannelFromPlayer() {
            // í”Œë ˆì´ì–´ ë‹«ê³  ì±„ë„ ì—´ê¸°
            document.getElementById('watch-page').classList.remove('active');
            // í”Œë ˆì´ì–´ëŠ” ë„ì§€ ì•Šê³  ì†Œë¦¬ë§Œ ë©ˆì¶”ê±°ë‚˜, ì•±ì²˜ëŸ¼ ë°‘ìœ¼ë¡œ ë‚´ë¦¬ëŠ” êµ¬í˜„ì€ ë³µì¡í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ë©ˆì¶¤
            player.pauseVideo(); 
            openChannel(currentChannelId);
        }

        // --- 5. ìœ í‹¸ë¦¬í‹° ---
        function formatCount(num) {
            if(!num) return '0';
            if (num > 10000) return Math.floor(num/10000) + 'ë§Œ';
            return num;
        }
        function timeAgo(dateStr) {
            const diff = (new Date() - new Date(dateStr)) / 1000;
            if (diff < 86400) return 'ë°©ê¸ˆ ì „';
            if (diff < 604800) return Math.floor(diff/86400) + 'ì¼ ì „';
            if (diff < 2592000) return Math.floor(diff/604800) + 'ì£¼ ì „';
            return Math.floor(diff/2592000) + 'ê°œì›” ì „';
        }
        function formatTime(sec) {
            sec = Math.floor(sec);
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return m + ':' + (s < 10 ? '0'+s : s);
        }
        function escapeHtml(text) {
            return text.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
        }

    </script>
</body>
</html>
